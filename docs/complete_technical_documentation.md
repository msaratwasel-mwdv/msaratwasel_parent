# ğŸ“š Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© - Ù†Ø¸Ø§Ù… Ù…Ø³Ø§Ø±Ø§Øª ÙˆØ§ØµÙ„
## Msarat Wasel - Complete Technical Documentation

---

# Ø§Ù„ÙÙ‡Ø±Ø³
1. [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…](#1-Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©-Ø¹Ù„Ù‰-Ø§Ù„Ù†Ø¸Ø§Ù…)
2. [Ø¨Ù†ÙŠØ© Flutter App (lib)](#2-Ø¨Ù†ÙŠØ©-flutter-app-lib)
3. [Ø¨Ù†ÙŠØ© Laravel Backend](#3-Ø¨Ù†ÙŠØ©-laravel-backend)
4. [Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Supabase](#4-Ù‚Ø§Ø¹Ø¯Ø©-Ø¨ÙŠØ§Ù†Ø§Øª-supabase)
5. [ÙˆØ«Ø§Ø¦Ù‚ API](#5-ÙˆØ«Ø§Ø¦Ù‚-api)
6. [ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙŠØ²Ø§Øª](#6-ØªÙØ§ØµÙŠÙ„-Ø§Ù„Ù…ÙŠØ²Ø§Øª)
7. [Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø±](#7-Ù…ØªØ·Ù„Ø¨Ø§Øª-Ø§Ù„Ù†Ø´Ø±)

---

# 1. Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…

## 1.1 ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ ÙŠØ±Ø¨Ø· Ø¨ÙŠÙ† Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± ÙˆØ§Ù„Ù…Ø´Ø±ÙÙŠÙ† ÙˆØ§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†.

## 1.2 Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†
| Ø§Ù„Ø¯ÙˆØ± | Ø§Ù„ÙˆØµÙ |
|-------|-------|
| **ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±** | ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ØŒ Ø§Ù„ØªÙˆØ§ØµÙ„ØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºÙŠØ§Ø¨ |
| **Ø§Ù„Ù…Ø´Ø±Ù** | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø£Ù‡Ø§Ù„ÙŠ |
| **Ø§Ù„Ø³Ø§Ø¦Ù‚** | Ø§Ù„ØªØªØ¨Ø¹ GPSØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø­Ù„Ø§Øª |
| **Ø§Ù„Ù…Ø¯ÙŠØ±** | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„ |

## 1.3 Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ©
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Mobile Apps (Flutter)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Parent App  â”‚  â”‚ Driver App  â”‚  â”‚Supervisor   â”‚      
â”‚  â”‚   (iOS)     â”‚  â”‚   (iOS)     â”‚  â”‚    App      â”‚      â”‚
â”‚  â”‚  (Android)  â”‚  â”‚  (Android)  â”‚  â”‚(iOS/Android)â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   Laravel   â”‚
                    â”‚   Backend   â”‚
                    â”‚  (API/REST) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                â”‚                â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚  Supabase   â”‚  â”‚  Firebase   â”‚  â”‚   Redis     â”‚
   â”‚ (Database)  â”‚  â”‚    (FCM)    â”‚  â”‚  (Cache)    â”‚
   â”‚ (Storage)   â”‚  â”‚ (Analytics) â”‚  â”‚ (WebSocket) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# 2. Ø¨Ù†ÙŠØ© Flutter App (lib)

## 2.1 Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ÙƒØ§Ù…Ù„
```
lib/                                    # ğŸ“ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
â”œâ”€â”€ main.dart                           # ğŸš€ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
â”‚
â””â”€â”€ src/                                # ğŸ“ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØµØ¯Ø±ÙŠ
    â”‚
    â”œâ”€â”€ app/                            # ğŸ“ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    â”‚   â”œâ”€â”€ app.dart                    # MaterialApp Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    â”‚   â””â”€â”€ state/
    â”‚       â”œâ”€â”€ app_controller.dart     # Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© (ChangeNotifier)
    â”‚       â””â”€â”€ app_bloc.dart           # Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© (BLoC)
    â”‚
    â”œâ”€â”€ core/                           # ğŸ“ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    â”‚   â”œâ”€â”€ config/
    â”‚   â”‚   â”œâ”€â”€ app_config.dart         # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©
    â”‚   â”‚   â””â”€â”€ api_keys.dart           # Ù…ÙØ§ØªÙŠØ­ API
    â”‚   â”‚
    â”‚   â”œâ”€â”€ data/
    â”‚   â”‚   â””â”€â”€ sample_data.dart        # Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    â”‚   â”‚
    â”‚   â”œâ”€â”€ models/
    â”‚   â”‚   â””â”€â”€ app_models.dart         # Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    â”‚   â”‚
    â”‚   â”œâ”€â”€ network/
    â”‚   â”‚   â”œâ”€â”€ api_client.dart         # Dio Client
    â”‚   â”‚   â””â”€â”€ interceptors.dart       # Auth & Logging
    â”‚   â”‚
    â”‚   â”œâ”€â”€ routing/
    â”‚   â”‚   â””â”€â”€ app_router.dart         # Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
    â”‚   â”‚
    â”‚   â”œâ”€â”€ storage/
    â”‚   â”‚   â”œâ”€â”€ storage_keys.dart       # Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ†
    â”‚   â”‚   â””â”€â”€ storage_service.dart    # SharedPreferences
    â”‚   â”‚
    â”‚   â””â”€â”€ utils/
    â”‚       â””â”€â”€ result.dart             # Result<T> Pattern
    â”‚
    â”œâ”€â”€ features/                       # ğŸ“ Ø§Ù„Ù…ÙŠØ²Ø§Øª (18 Ù…ÙŠØ²Ø©)
    â”‚   â”‚
    â”‚   â”œâ”€â”€ auth/                       # ğŸ” Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    â”‚   â”‚   â”œâ”€â”€ data/
    â”‚   â”‚   â”‚   â””â”€â”€ repositories/
    â”‚   â”‚   â”‚       â””â”€â”€ auth_repository.dart
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”‚   â”œâ”€â”€ entities/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth_user.dart
    â”‚   â”‚   â”‚   â””â”€â”€ usecases/
    â”‚   â”‚   â”‚       â””â”€â”€ login_usecase.dart
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â”œâ”€â”€ login_screen.dart
    â”‚   â”‚       â”œâ”€â”€ otp_verification_screen.dart
    â”‚   â”‚       â”œâ”€â”€ forgot_password_screen.dart
    â”‚   â”‚       â””â”€â”€ widgets/
    â”‚   â”‚           â””â”€â”€ auth_background.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ splash/                     # ğŸ¬ Splash Screen
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â””â”€â”€ splash_screen.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ onboarding/                 # ğŸ“– Introduction
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â””â”€â”€ onboarding_page.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ dashboard/                  # ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
    â”‚   â”‚   â”œâ”€â”€ data/
    â”‚   â”‚   â”‚   â””â”€â”€ repositories/
    â”‚   â”‚   â”‚       â””â”€â”€ dashboard_repository.dart
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”‚   â””â”€â”€ entities/
    â”‚   â”‚   â”‚       â””â”€â”€ child_summary.dart
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â”œâ”€â”€ root_shell.dart     # â­ Shell Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    â”‚   â”‚       â”œâ”€â”€ dashboard_page.dart
    â”‚   â”‚       â”œâ”€â”€ dashboard_screen.dart
    â”‚   â”‚       â””â”€â”€ pages/
    â”‚   â”‚           â””â”€â”€ parent_dashboard_page.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ home/                       # ğŸ¡ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â”œâ”€â”€ home_screen.dart
    â”‚   â”‚       â””â”€â”€ home_page.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ children/                   # ğŸ‘¶ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â”œâ”€â”€ children_screen.dart
    â”‚   â”‚       â”œâ”€â”€ location_picker_screen.dart
    â”‚   â”‚       â””â”€â”€ pages/
    â”‚   â”‚           â””â”€â”€ children_status_page.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ students/                   # ğŸ“ Ø§Ù„Ø·Ù„Ø§Ø¨
    â”‚   â”‚   â”œâ”€â”€ data/
    â”‚   â”‚   â”‚   â””â”€â”€ repositories/
    â”‚   â”‚   â”‚       â””â”€â”€ students_repository.dart
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”‚   â””â”€â”€ entities/
    â”‚   â”‚   â”‚       â””â”€â”€ student.dart
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â”œâ”€â”€ child_list_screen.dart
    â”‚   â”‚       â”œâ”€â”€ child_detail_screen.dart
    â”‚   â”‚       â””â”€â”€ pages/
    â”‚   â”‚           â”œâ”€â”€ child_list_page.dart
    â”‚   â”‚           â”œâ”€â”€ child_detail_page.dart
    â”‚   â”‚           â””â”€â”€ add_child_page.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ tracking/                   # ğŸšŒ ØªØªØ¨Ø¹ Ø§Ù„Ø­Ø§ÙÙ„Ø©
    â”‚   â”‚   â”œâ”€â”€ data/
    â”‚   â”‚   â”‚   â””â”€â”€ repositories/
    â”‚   â”‚   â”‚       â””â”€â”€ tracking_repository.dart
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”‚   â””â”€â”€ entities/
    â”‚   â”‚   â”‚       â””â”€â”€ bus_position.dart
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â”œâ”€â”€ tracking_page.dart  # â­ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    â”‚   â”‚       â”œâ”€â”€ bus_tracking_screen.dart
    â”‚   â”‚       â”œâ”€â”€ pages/
    â”‚   â”‚       â”‚   â””â”€â”€ bus_tracking_page.dart
    â”‚   â”‚       â””â”€â”€ widgets/
    â”‚   â”‚           â””â”€â”€ student_marker_widget.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ notifications/              # ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    â”‚   â”‚   â”œâ”€â”€ data/
    â”‚   â”‚   â”‚   â””â”€â”€ repositories/
    â”‚   â”‚   â”‚       â””â”€â”€ notifications_repository.dart
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”‚   â””â”€â”€ entities/
    â”‚   â”‚   â”‚       â””â”€â”€ app_notification.dart
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â”œâ”€â”€ notifications_page.dart
    â”‚   â”‚       â””â”€â”€ pages/
    â”‚   â”‚           â””â”€â”€ notifications_page.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ messages/                   # ğŸ’¬ Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø©
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â””â”€â”€ messages_page.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ communication/              # ğŸ“ Ø§Ù„ØªÙˆØ§ØµÙ„
    â”‚   â”‚   â”œâ”€â”€ data/
    â”‚   â”‚   â”‚   â””â”€â”€ repositories/
    â”‚   â”‚   â”‚       â””â”€â”€ communication_repository.dart
    â”‚   â”‚   â””â”€â”€ domain/
    â”‚   â”‚       â””â”€â”€ entities/
    â”‚   â”‚           â””â”€â”€ message_thread.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ attendance/                 # âœ… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨
    â”‚   â”‚   â”œâ”€â”€ presentation/
    â”‚   â”‚   â”‚   â”œâ”€â”€ request_absence_page.dart
    â”‚   â”‚   â”‚   â””â”€â”€ attendance_history_page.dart
    â”‚   â”‚   â””â”€â”€ widgets/
    â”‚   â”‚       â””â”€â”€ absence_sheet.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ profile/                    # ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
    â”‚   â”‚   â”œâ”€â”€ data/
    â”‚   â”‚   â”‚   â””â”€â”€ repositories/
    â”‚   â”‚   â”‚       â””â”€â”€ profile_repository.dart
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”‚   â””â”€â”€ entities/
    â”‚   â”‚   â”‚       â””â”€â”€ profile.dart
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â””â”€â”€ parent_profile_page.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ settings/                   # âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    â”‚   â”‚   â””â”€â”€ presentation/
    â”‚   â”‚       â”œâ”€â”€ more_page.dart
    â”‚   â”‚       â”œâ”€â”€ about_app_page.dart
    â”‚   â”‚       â”œâ”€â”€ contact_us_page.dart
    â”‚   â”‚       â”œâ”€â”€ privacy_policy_page.dart
    â”‚   â”‚       â””â”€â”€ change_password_page.dart
    â”‚   â”‚
    â”‚   â”œâ”€â”€ complaints/                 # ğŸ“ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰
    â”‚   â”‚   â”œâ”€â”€ data/
    â”‚   â”‚   â”‚   â””â”€â”€ repositories/
    â”‚   â”‚   â”‚       â””â”€â”€ complaints_repository.dart
    â”‚   â”‚   â””â”€â”€ domain/
    â”‚   â”‚       â””â”€â”€ entities/
    â”‚   â”‚           â””â”€â”€ complaint.dart
    â”‚   â”‚
    â”‚   â””â”€â”€ language/                   # ğŸŒ Ø§Ù„Ù„ØºØ©
    â”‚       â”œâ”€â”€ data/
    â”‚       â”‚   â””â”€â”€ repositories/
    â”‚       â”‚       â””â”€â”€ language_repository.dart
    â”‚       â”œâ”€â”€ domain/
    â”‚       â”‚   â””â”€â”€ usecases/
    â”‚       â”‚       â””â”€â”€ set_locale_usecase.dart
    â”‚       â””â”€â”€ presentation/
    â”‚           â”œâ”€â”€ language_selector_screen.dart
    â”‚           â””â”€â”€ pages/
    â”‚               â””â”€â”€ language_selector_page.dart
    â”‚
    â””â”€â”€ shared/                         # ğŸ“ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
        â”‚
        â”œâ”€â”€ localization/
        â”‚   â””â”€â”€ app_strings.dart        # 290+ Ù…ÙØªØ§Ø­ ØªØ±Ø¬Ù…Ø©
        â”‚
        â”œâ”€â”€ theme/
        â”‚   â”œâ”€â”€ app_colors.dart         # Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯
        â”‚   â”œâ”€â”€ app_theme.dart          # Light/Dark Theme
        â”‚   â”œâ”€â”€ app_typography.dart     # Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù†Øµ
        â”‚   â”œâ”€â”€ app_spacing.dart        # Ø§Ù„Ù…Ø³Ø§ÙØ§Øª
        â”‚   â””â”€â”€ ui_palette.dart         # Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†
        â”‚
        â”œâ”€â”€ presentation/
        â”‚   â””â”€â”€ widgets/
        â”‚       â”œâ”€â”€ animated_background.dart
        â”‚       â””â”€â”€ app_sliver_header.dart
        â”‚
        â”œâ”€â”€ widgets/
        â”‚   â”œâ”€â”€ custom_text_field.dart
        â”‚   â”œâ”€â”€ frosted_card.dart
        â”‚   â””â”€â”€ primary_button.dart
        â”‚
        â”œâ”€â”€ services/
        â”‚   â””â”€â”€ places_service.dart     # Google Places API
        â”‚
        â””â”€â”€ utils/
            â”œâ”€â”€ date_utils.dart
            â”œâ”€â”€ labels.dart
            â””â”€â”€ marker_generator.dart
```

## 2.2 ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### main.dart
```dart
// Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  FlutterNativeSplash.preserve(widgetsBinding: ...);
  runApp(const MsaratWaselApp());
}
```

### app_controller.dart (Ø§Ù„Ø£Ù‡Ù…)
```dart
class AppController extends ChangeNotifier {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Locale _locale;              // Ø§Ù„Ù„ØºØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (ar/en)
  ThemeMode _themeMode;        // Ø§Ù„ÙˆØ¶Ø¹ (light/dark/system)
  bool _isAuthenticated;        // Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  int _navIndex;               // Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  
  List<Student> _students;      // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡
  List<Notification> _notifications;
  List<MessageItem> _messages;
  List<AttendanceEntry> _attendance;
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GETTERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  String get userName;          // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©
  String get userAvatarUrl;     // ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• METHODS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Future<void> bootstrap();     // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  Future<void> login(...);      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  void logout();                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
  void setNavIndex(int index);  // Ø§Ù„ØªÙ†Ù‚Ù„
  void setLocale(Locale);       // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
  void toggleTheme();           // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©
}
```

### root_shell.dart (Shell Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)
```dart
class RootShell extends StatefulWidget {
  // ÙŠØ¯ÙŠØ±:
  // - Bottom Navigation Bar (5 tabs)
  // - Side Drawer (Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø§Ù†Ø¨ÙŠØ©)
  // - Ø§Ù„Ù€ 10 ØµÙØ­Ø§Øª:
  //   0: HomeScreen
  //   1: ChildrenScreen
  //   2: TrackingPage
  //   3: ChildrenStatusPage
  //   4: NotificationsPage
  //   5: MessagesPage
  //   6: RequestAbsencePage
  //   7: AttendanceHistoryPage
  //   8: ParentProfilePage
  //   9: MorePage
}
```

---

# 3. Ø¨Ù†ÙŠØ© Laravel Backend

## 3.1 Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­
```
laravel-msaratwasel/
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Http/
â”‚   â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ Api/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StudentController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TrackingController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NotificationController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessageController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AttendanceController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TripController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BusController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SchoolController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProfileController.php
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ComplaintController.php
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ WebSocket/
â”‚   â”‚   â”‚       â”œâ”€â”€ TrackingHandler.php
â”‚   â”‚   â”‚       â””â”€â”€ MessageHandler.php
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Middleware/
â”‚   â”‚   â”‚   â”œâ”€â”€ JwtMiddleware.php
â”‚   â”‚   â”‚   â”œâ”€â”€ RoleMiddleware.php
â”‚   â”‚   â”‚   â””â”€â”€ LocaleMiddleware.php
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Requests/
â”‚   â”‚   â”‚   â”œâ”€â”€ Auth/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginRequest.php
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ VerifyOtpRequest.php
â”‚   â”‚   â”‚   â”œâ”€â”€ Student/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CreateStudentRequest.php
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UpdateLocationRequest.php
â”‚   â”‚   â”‚   â””â”€â”€ Attendance/
â”‚   â”‚   â”‚       â””â”€â”€ AbsenceRequest.php
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Resources/
â”‚   â”‚       â”œâ”€â”€ StudentResource.php
â”‚   â”‚       â”œâ”€â”€ NotificationResource.php
â”‚   â”‚       â”œâ”€â”€ MessageResource.php
â”‚   â”‚       â””â”€â”€ AttendanceResource.php
â”‚   â”‚
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”œâ”€â”€ User.php
â”‚   â”‚   â”œâ”€â”€ Parent.php
â”‚   â”‚   â”œâ”€â”€ Student.php
â”‚   â”‚   â”œâ”€â”€ School.php
â”‚   â”‚   â”œâ”€â”€ Bus.php
â”‚   â”‚   â”œâ”€â”€ Driver.php
â”‚   â”‚   â”œâ”€â”€ Supervisor.php
â”‚   â”‚   â”œâ”€â”€ Trip.php
â”‚   â”‚   â”œâ”€â”€ Attendance.php
â”‚   â”‚   â”œâ”€â”€ AbsenceRequest.php
â”‚   â”‚   â”œâ”€â”€ Notification.php
â”‚   â”‚   â”œâ”€â”€ Conversation.php
â”‚   â”‚   â”œâ”€â”€ Message.php
â”‚   â”‚   â””â”€â”€ Complaint.php
â”‚   â”‚
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”œâ”€â”€ OtpService.php
â”‚   â”‚   â”œâ”€â”€ NotificationService.php
â”‚   â”‚   â”œâ”€â”€ TrackingService.php
â”‚   â”‚   â”œâ”€â”€ SmsService.php
â”‚   â”‚   â””â”€â”€ FirebaseService.php
â”‚   â”‚
â”‚   â”œâ”€â”€ Repositories/
â”‚   â”‚   â”œâ”€â”€ UserRepository.php
â”‚   â”‚   â”œâ”€â”€ StudentRepository.php
â”‚   â”‚   â”œâ”€â”€ TripRepository.php
â”‚   â”‚   â””â”€â”€ AttendanceRepository.php
â”‚   â”‚
â”‚   â”œâ”€â”€ Events/
â”‚   â”‚   â”œâ”€â”€ BusLocationUpdated.php
â”‚   â”‚   â”œâ”€â”€ StudentPickedUp.php
â”‚   â”‚   â”œâ”€â”€ StudentDroppedOff.php
â”‚   â”‚   â””â”€â”€ NewMessageSent.php
â”‚   â”‚
â”‚   â””â”€â”€ Listeners/
â”‚       â”œâ”€â”€ SendPushNotification.php
â”‚       â””â”€â”€ UpdateParentDashboard.php
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ app.php
â”‚   â”œâ”€â”€ auth.php
â”‚   â”œâ”€â”€ database.php
â”‚   â”œâ”€â”€ firebase.php
â”‚   â””â”€â”€ websockets.php
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000001_create_users_table.php
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000002_create_schools_table.php
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000003_create_parents_table.php
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000004_create_buses_table.php
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000005_create_students_table.php
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000006_create_trips_table.php
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000007_create_attendances_table.php
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000008_create_absence_requests_table.php
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000009_create_notifications_table.php
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000010_create_conversations_table.php
â”‚   â”‚   â”œâ”€â”€ 2026_01_01_000011_create_messages_table.php
â”‚   â”‚   â””â”€â”€ 2026_01_01_000012_create_complaints_table.php
â”‚   â”‚
â”‚   â””â”€â”€ seeders/
â”‚       â”œâ”€â”€ DatabaseSeeder.php
â”‚       â”œâ”€â”€ SchoolSeeder.php
â”‚       â”œâ”€â”€ UserSeeder.php
â”‚       â””â”€â”€ BusSeeder.php
â”‚
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ api.php                 # ğŸ“ API Routes
â”‚   â”œâ”€â”€ channels.php            # WebSocket Channels
â”‚   â””â”€â”€ web.php
â”‚
â””â”€â”€ .env
```

## 3.2 API Routes (routes/api.php)
```php
<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\Api\*;

/*
|--------------------------------------------------------------------------
| Authentication Routes
|--------------------------------------------------------------------------
*/
Route::prefix('auth')->group(function () {
    Route::post('login', [AuthController::class, 'login']);
    Route::post('verify-otp', [AuthController::class, 'verifyOtp']);
    Route::post('resend-otp', [AuthController::class, 'resendOtp']);
    Route::post('forgot-password', [AuthController::class, 'forgotPassword']);
    Route::post('reset-password', [AuthController::class, 'resetPassword']);
    
    Route::middleware('auth:api')->group(function () {
        Route::post('refresh', [AuthController::class, 'refresh']);
        Route::post('logout', [AuthController::class, 'logout']);
    });
});

/*
|--------------------------------------------------------------------------
| Protected Routes (Require Authentication)
|--------------------------------------------------------------------------
*/
Route::middleware('auth:api')->group(function () {

    /*
    |----------------------------------------------------------------------
    | Profile Routes
    |----------------------------------------------------------------------
    */
    Route::prefix('profile')->group(function () {
        Route::get('/', [ProfileController::class, 'show']);
        Route::put('/', [ProfileController::class, 'update']);
        Route::post('avatar', [ProfileController::class, 'updateAvatar']);
        Route::put('password', [ProfileController::class, 'changePassword']);
        Route::put('fcm-token', [ProfileController::class, 'updateFcmToken']);
    });

    /*
    |----------------------------------------------------------------------
    | Students Routes (Parent Only)
    |----------------------------------------------------------------------
    */
    Route::middleware('role:parent')->group(function () {
        Route::apiResource('students', StudentController::class);
        Route::put('students/{student}/location', [StudentController::class, 'updateLocation']);
    });

    /*
    |----------------------------------------------------------------------
    | Tracking Routes
    |----------------------------------------------------------------------
    */
    Route::prefix('tracking')->group(function () {
        Route::get('bus/{bus}', [TrackingController::class, 'getBusLocation']);
        Route::get('student/{student}', [TrackingController::class, 'getStudentTracking']);
        Route::post('bus/{bus}/location', [TrackingController::class, 'updateBusLocation'])->middleware('role:driver');
    });

    /*
    |----------------------------------------------------------------------
    | Notifications Routes
    |----------------------------------------------------------------------
    */
    Route::prefix('notifications')->group(function () {
        Route::get('/', [NotificationController::class, 'index']);
        Route::get('unread-count', [NotificationController::class, 'unreadCount']);
        Route::put('{notification}/read', [NotificationController::class, 'markAsRead']);
        Route::put('read-all', [NotificationController::class, 'markAllAsRead']);
    });

    /*
    |----------------------------------------------------------------------
    | Messages Routes
    |----------------------------------------------------------------------
    */
    Route::prefix('messages')->group(function () {
        Route::get('conversations', [MessageController::class, 'getConversations']);
        Route::get('conversations/{conversation}', [MessageController::class, 'getMessages']);
        Route::post('conversations/{conversation}', [MessageController::class, 'sendMessage']);
        Route::post('conversations', [MessageController::class, 'startConversation']);
    });

    /*
    |----------------------------------------------------------------------
    | Attendance Routes
    |----------------------------------------------------------------------
    */
    Route::prefix('attendance')->group(function () {
        Route::get('history', [AttendanceController::class, 'history']);
        Route::get('summary', [AttendanceController::class, 'summary']);
        Route::post('absence-request', [AttendanceController::class, 'requestAbsence']);
        Route::get('absence-requests', [AttendanceController::class, 'getAbsenceRequests']);
        
        // Supervisor Only
        Route::middleware('role:supervisor')->group(function () {
            Route::post('record', [AttendanceController::class, 'record']);
        });
    });

    /*
    |----------------------------------------------------------------------
    | Trips Routes
    |----------------------------------------------------------------------
    */
    Route::prefix('trips')->group(function () {
        Route::get('/', [TripController::class, 'index']);
        Route::get('{trip}', [TripController::class, 'show']);
        Route::get('active', [TripController::class, 'getActiveTrip']);
        
        // Driver/Supervisor Only
        Route::middleware('role:driver,supervisor')->group(function () {
            Route::post('start', [TripController::class, 'start']);
            Route::post('{trip}/end', [TripController::class, 'end']);
        });
    });

    /*
    |----------------------------------------------------------------------
    | Complaints Routes
    |----------------------------------------------------------------------
    */
    Route::prefix('complaints')->group(function () {
        Route::get('/', [ComplaintController::class, 'index']);
        Route::post('/', [ComplaintController::class, 'store']);
    });

    /*
    |----------------------------------------------------------------------
    | Dashboard Routes
    |----------------------------------------------------------------------
    */
    Route::get('dashboard', [DashboardController::class, 'index']);
});
```

## 3.3 Controllers Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### AuthController.php
```php
<?php

namespace App\Http\Controllers\Api;

class AuthController extends Controller
{
    /**
     * ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ OTP
     * POST /api/auth/login
     */
    public function login(LoginRequest $request)
    {
        $user = User::where('civil_id', $request->civil_id)
                    ->where('phone', $request->phone)
                    ->first();

        if (!$user) {
            return response()->json([
                'success' => false,
                'message' => 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'
            ], 404);
        }

        // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø±Ø³Ø§Ù„ OTP
        $otp = $this->otpService->generate($user);
        $this->smsService->send($user->phone, "Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚: {$otp}");

        return response()->json([
            'success' => true,
            'message' => 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚',
            'data' => [
                'otp_expiry' => 300,
                'phone_masked' => $this->maskPhone($user->phone)
            ]
        ]);
    }

    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† OTP
     * POST /api/auth/verify-otp
     */
    public function verifyOtp(VerifyOtpRequest $request)
    {
        $user = User::where('civil_id', $request->civil_id)->first();
        
        if (!$this->otpService->verify($user, $request->otp)) {
            return response()->json([
                'success' => false,
                'message' => 'Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ'
            ], 401);
        }

        $token = auth()->login($user);

        return response()->json([
            'success' => true,
            'data' => [
                'access_token' => $token,
                'refresh_token' => $this->generateRefreshToken($user),
                'expires_in' => config('jwt.ttl') * 60,
                'user' => new UserResource($user)
            ]
        ]);
    }
}
```

### StudentController.php
```php
<?php

namespace App\Http\Controllers\Api;

class StudentController extends Controller
{
    /**
     * Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡
     * GET /api/students
     */
    public function index()
    {
        $parent = auth()->user()->parent;
        $students = $parent->students()
            ->with(['school', 'bus', 'bus.driver', 'bus.supervisor'])
            ->get();

        return StudentResource::collection($students);
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
     * PUT /api/students/{student}/location
     */
    public function updateLocation(UpdateLocationRequest $request, Student $student)
    {
        $this->authorize('update', $student);

        $student->update([
            'pickup_lat' => $request->lat,
            'pickup_lng' => $request->lng,
            'pickup_address' => $request->address
        ]);

        return response()->json([
            'success' => true,
            'message' => 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­'
        ]);
    }
}
```

### TrackingController.php
```php
<?php

namespace App\Http\Controllers\Api;

class TrackingController extends Controller
{
    /**
     * Ø¬Ù„Ø¨ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§ÙÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ
     * GET /api/tracking/bus/{bus}
     */
    public function getBusLocation(Bus $bus)
    {
        return response()->json([
            'success' => true,
            'data' => [
                'bus_id' => $bus->id,
                'lat' => $bus->current_lat,
                'lng' => $bus->current_lng,
                'speed' => $bus->speed,
                'heading' => $bus->heading,
                'bus_state' => $bus->bus_state,
                'last_update' => $bus->last_location_update,
                'driver' => new DriverResource($bus->driver),
                'supervisor' => new SupervisorResource($bus->supervisor)
            ]
        ]);
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§ÙÙ„Ø© (Ù„Ù„Ø³Ø§Ø¦Ù‚)
     * POST /api/tracking/bus/{bus}/location
     */
    public function updateBusLocation(Request $request, Bus $bus)
    {
        $bus->update([
            'current_lat' => $request->lat,
            'current_lng' => $request->lng,
            'speed' => $request->speed,
            'heading' => $request->heading,
            'last_location_update' => now()
        ]);

        // Ø¨Ø« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø¨Ø± WebSocket
        broadcast(new BusLocationUpdated($bus))->toOthers();

        return response()->json(['success' => true]);
    }
}
```

---

# 4. Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Supabase

## 4.1 Ø¥Ø¹Ø¯Ø§Ø¯ Supabase
```bash
# 1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ ÙÙŠ supabase.com
# 2. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰:
#    - Project URL
#    - anon/public key
#    - service_role key

# 3. ØªÙƒÙˆÙŠÙ† Laravel .env
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

DB_CONNECTION=pgsql
DB_HOST=db.xxxxx.supabase.co
DB_PORT=5432
DB_DATABASE=postgres
DB_USERNAME=postgres
DB_PASSWORD=your-db-password
```

## 4.2 Ø¬Ø¯Ø§ÙˆÙ„ Supabase (PostgreSQL)

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 1: users
```sql
-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    civil_id VARCHAR(12) UNIQUE NOT NULL,
    phone VARCHAR(15) NOT NULL,
    name_ar VARCHAR(100) NOT NULL,
    name_en VARCHAR(100),
    email VARCHAR(100),
    password_hash VARCHAR(255),
    avatar_url TEXT,
    role VARCHAR(20) NOT NULL CHECK (role IN ('parent', 'supervisor', 'driver', 'admin')),
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'suspended')),
    fcm_token TEXT,
    locale VARCHAR(5) DEFAULT 'ar',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_users_civil_id ON users(civil_id);
CREATE INDEX idx_users_phone ON users(phone);
CREATE INDEX idx_users_role ON users(role);

-- RLS Policies
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own profile"
    ON users FOR SELECT
    USING (auth.uid() = id);

CREATE POLICY "Users can update own profile"
    ON users FOR UPDATE
    USING (auth.uid() = id);
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 2: parents
```sql
CREATE TABLE parents (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    home_lat DECIMAL(10, 8),
    home_lng DECIMAL(11, 8),
    home_address TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_parents_user_id ON parents(user_id);
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 3: schools
```sql
CREATE TABLE schools (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name_ar VARCHAR(200) NOT NULL,
    name_en VARCHAR(200),
    lat DECIMAL(10, 8) NOT NULL,
    lng DECIMAL(11, 8) NOT NULL,
    address TEXT,
    phone VARCHAR(15),
    principal_name VARCHAR(100),
    logo_url TEXT,
    start_time TIME DEFAULT '07:00:00',
    end_time TIME DEFAULT '14:00:00',
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 4: buses
```sql
CREATE TABLE buses (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    plate_number VARCHAR(20) UNIQUE NOT NULL,
    capacity INT DEFAULT 30,
    model VARCHAR(100),
    year INT,
    driver_id UUID REFERENCES users(id),
    supervisor_id UUID REFERENCES users(id),
    school_id UUID NOT NULL REFERENCES schools(id),
    
    -- Location Tracking
    current_lat DECIMAL(10, 8),
    current_lng DECIMAL(11, 8),
    speed DECIMAL(5, 2) DEFAULT 0,
    heading DECIMAL(5, 2) DEFAULT 0,
    
    bus_state VARCHAR(30) DEFAULT 'idle' 
        CHECK (bus_state IN ('idle', 'morning_trip', 'school_arrived', 'afternoon_trip', 'completed')),
    status VARCHAR(20) DEFAULT 'active' 
        CHECK (status IN ('active', 'maintenance', 'inactive')),
    last_location_update TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Realtime Ù„Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
ALTER PUBLICATION supabase_realtime ADD TABLE buses;
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 5: students
```sql
CREATE TABLE students (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    parent_id UUID NOT NULL REFERENCES parents(id),
    school_id UUID NOT NULL REFERENCES schools(id),
    bus_id UUID REFERENCES buses(id),
    
    name_ar VARCHAR(100) NOT NULL,
    name_en VARCHAR(100),
    grade VARCHAR(20),
    class_name VARCHAR(20),
    photo_url TEXT,
    gender VARCHAR(10) NOT NULL CHECK (gender IN ('male', 'female')),
    date_of_birth DATE,
    
    -- Pickup Location
    pickup_lat DECIMAL(10, 8),
    pickup_lng DECIMAL(11, 8),
    pickup_address TEXT,
    
    status VARCHAR(20) DEFAULT 'active' 
        CHECK (status IN ('active', 'inactive', 'graduated')),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_students_parent ON students(parent_id);
CREATE INDEX idx_students_school ON students(school_id);
CREATE INDEX idx_students_bus ON students(bus_id);
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 6: trips
```sql
CREATE TABLE trips (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    bus_id UUID NOT NULL REFERENCES buses(id),
    trip_type VARCHAR(20) NOT NULL CHECK (trip_type IN ('morning', 'afternoon')),
    date DATE NOT NULL,
    
    started_at TIMESTAMPTZ,
    ended_at TIMESTAMPTZ,
    start_lat DECIMAL(10, 8),
    start_lng DECIMAL(11, 8),
    end_lat DECIMAL(10, 8),
    end_lng DECIMAL(11, 8),
    
    total_students INT DEFAULT 0,
    picked_up_count INT DEFAULT 0,
    dropped_off_count INT DEFAULT 0,
    
    status VARCHAR(20) DEFAULT 'scheduled' 
        CHECK (status IN ('scheduled', 'in_progress', 'completed', 'cancelled')),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_trips_date ON trips(date);
CREATE INDEX idx_trips_bus_date ON trips(bus_id, date);
CREATE UNIQUE INDEX idx_trips_unique ON trips(bus_id, date, trip_type);
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 7: attendances
```sql
CREATE TABLE attendances (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    student_id UUID NOT NULL REFERENCES students(id),
    trip_id UUID NOT NULL REFERENCES trips(id),
    
    attendance_type VARCHAR(20) NOT NULL CHECK (attendance_type IN ('pickup', 'dropoff')),
    status VARCHAR(20) NOT NULL 
        CHECK (status IN ('picked_up', 'dropped_off', 'absent', 'excused')),
    
    recorded_at TIMESTAMPTZ DEFAULT NOW(),
    recorded_by UUID REFERENCES users(id),
    lat DECIMAL(10, 8),
    lng DECIMAL(11, 8),
    notes TEXT,
    
    UNIQUE(student_id, trip_id, attendance_type)
);

CREATE INDEX idx_attendances_student ON attendances(student_id);
CREATE INDEX idx_attendances_trip ON attendances(trip_id);
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 8: absence_requests
```sql
CREATE TABLE absence_requests (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    student_id UUID NOT NULL REFERENCES students(id),
    parent_id UUID NOT NULL REFERENCES parents(id),
    
    date_from DATE NOT NULL,
    date_to DATE NOT NULL,
    reason TEXT,
    
    status VARCHAR(20) DEFAULT 'pending' 
        CHECK (status IN ('pending', 'approved', 'rejected')),
    reviewed_by UUID REFERENCES users(id),
    reviewed_at TIMESTAMPTZ,
    review_notes TEXT,
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 9: notifications
```sql
CREATE TABLE notifications (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id),
    
    notification_type VARCHAR(30) NOT NULL 
        CHECK (notification_type IN (
            'trip_start', 'approaching', 'arrived', 
            'picked_up', 'dropped_off', 'alert', 'general'
        )),
    
    title_ar VARCHAR(200) NOT NULL,
    title_en VARCHAR(200),
    body_ar TEXT,
    body_en TEXT,
    
    data JSONB,
    is_read BOOLEAN DEFAULT FALSE,
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_notifications_user ON notifications(user_id);
CREATE INDEX idx_notifications_read ON notifications(user_id, is_read);
CREATE INDEX idx_notifications_created ON notifications(created_at DESC);

-- Realtime Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ©
ALTER PUBLICATION supabase_realtime ADD TABLE notifications;
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 10: conversations
```sql
CREATE TABLE conversations (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    parent_id UUID NOT NULL REFERENCES parents(id),
    supervisor_id UUID NOT NULL REFERENCES users(id),
    
    last_message_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    
    UNIQUE(parent_id, supervisor_id)
);
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 11: messages
```sql
CREATE TABLE messages (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    conversation_id UUID NOT NULL REFERENCES conversations(id),
    sender_id UUID NOT NULL REFERENCES users(id),
    
    text TEXT,
    media_url TEXT,
    media_type VARCHAR(20) CHECK (media_type IN ('image', 'video', 'audio', 'document')),
    
    is_read BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_messages_conversation ON messages(conversation_id, created_at);

-- Realtime Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙÙˆØ±ÙŠØ©
ALTER PUBLICATION supabase_realtime ADD TABLE messages;
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 12: complaints
```sql
CREATE TABLE complaints (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id),
    
    subject VARCHAR(200) NOT NULL,
    description TEXT NOT NULL,
    category VARCHAR(50),
    
    status VARCHAR(20) DEFAULT 'open' 
        CHECK (status IN ('open', 'in_progress', 'resolved', 'closed')),
    
    assigned_to UUID REFERENCES users(id),
    resolution TEXT,
    resolved_at TIMESTAMPTZ,
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Ø§Ù„Ø¬Ø¯ÙˆÙ„ 13: otp_codes
```sql
CREATE TABLE otp_codes (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id),
    code VARCHAR(6) NOT NULL,
    expires_at TIMESTAMPTZ NOT NULL,
    is_used BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_otp_user ON otp_codes(user_id, is_used);
```

## 4.3 Supabase Functions

### Function: get_parent_dashboard
```sql
CREATE OR REPLACE FUNCTION get_parent_dashboard(parent_uuid UUID)
RETURNS JSONB AS $$
DECLARE
    result JSONB;
BEGIN
    SELECT jsonb_build_object(
        'students_count', (
            SELECT COUNT(*) FROM students 
            WHERE parent_id = parent_uuid AND status = 'active'
        ),
        'on_bus_count', (
            SELECT COUNT(*) FROM students s
            JOIN attendances a ON s.id = a.student_id
            WHERE s.parent_id = parent_uuid 
            AND a.status = 'picked_up'
            AND a.recorded_at::DATE = CURRENT_DATE
        ),
        'unread_notifications', (
            SELECT COUNT(*) FROM notifications n
            JOIN parents p ON p.user_id = n.user_id
            WHERE p.id = parent_uuid AND n.is_read = FALSE
        ),
        'active_trips', (
            SELECT jsonb_agg(jsonb_build_object(
                'trip_id', t.id,
                'bus_id', b.id,
                'plate_number', b.plate_number,
                'bus_state', b.bus_state,
                'lat', b.current_lat,
                'lng', b.current_lng
            ))
            FROM trips t
            JOIN buses b ON t.bus_id = b.id
            JOIN students s ON s.bus_id = b.id
            WHERE s.parent_id = parent_uuid
            AND t.status = 'in_progress'
            AND t.date = CURRENT_DATE
        )
    ) INTO result;
    
    RETURN result;
END;
$$ LANGUAGE plpgsql;
```

## 4.4 Supabase Storage Buckets

```sql
-- Ø¥Ù†Ø´Ø§Ø¡ Buckets Ù„Ù„Ù…Ù„ÙØ§Øª
INSERT INTO storage.buckets (id, name, public)
VALUES 
    ('avatars', 'avatars', true),
    ('student-photos', 'student-photos', true),
    ('message-attachments', 'message-attachments', false),
    ('school-logos', 'school-logos', true);

-- Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„
CREATE POLICY "Anyone can view avatars"
    ON storage.objects FOR SELECT
    USING (bucket_id = 'avatars');

CREATE POLICY "Users can upload own avatar"
    ON storage.objects FOR INSERT
    WITH CHECK (
        bucket_id = 'avatars' 
        AND auth.uid()::text = (storage.foldername(name))[1]
    );
```

---

# 5. ÙˆØ«Ø§Ø¦Ù‚ API

## 5.1 Authentication Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/auth/login` | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ |
| POST | `/api/auth/verify-otp` | Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† OTP |
| POST | `/api/auth/resend-otp` | Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ OTP |
| POST | `/api/auth/refresh` | ØªØ¬Ø¯ÙŠØ¯ Token |
| POST | `/api/auth/logout` | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ |

## 5.2 Students Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/students` | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ |
| GET | `/api/students/{id}` | ØªÙØ§ØµÙŠÙ„ Ø·Ø§Ù„Ø¨ |
| PUT | `/api/students/{id}/location` | ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… |

## 5.3 Tracking Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/tracking/bus/{id}` | Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§ÙÙ„Ø© |
| GET | `/api/tracking/student/{id}` | ØªØªØ¨Ø¹ Ø·Ø§Ù„Ø¨ Ù…Ø­Ø¯Ø¯ |
| WS | `wss://api/tracking/ws` | ØªØªØ¨Ø¹ Ù…Ø¨Ø§Ø´Ø± |

## 5.4 Full API Reference

> Ø±Ø§Ø¬Ø¹ Ù…Ù„Ù [project_documentation.md](file:///Users/abdurahmanal-hattami/.gemini/antigravity/brain/a9b16c82-7b3f-42be-8ac6-c2890e1c8a64/project_documentation.md) Ù„Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„ÙƒØ§Ù…Ù„Ø©

---

# 6. ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙŠØ²Ø§Øª

## Ù…Ù„Ø®Øµ Ø§Ù„Ù…ÙŠØ²Ø§Øª (18 Ù…ÙŠØ²Ø©)

| # | Ø§Ù„Ù…ÙŠØ²Ø© | Ø§Ù„Ø´Ø§Ø´Ø© | API |
|---|--------|--------|-----|
| 1 | Splash | splash_screen.dart | âŒ |
| 2 | Onboarding | onboarding_page.dart | âŒ |
| 3 | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ | login_screen.dart | POST /auth/login |
| 4 | OTP | otp_verification_screen.dart | POST /auth/verify-otp |
| 5 | Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© | home_screen.dart | GET /dashboard |
| 6 | Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ | children_screen.dart | GET /students |
| 7 | Ø§Ù„ØªØªØ¨Ø¹ | tracking_page.dart | WebSocket |
| 8 | Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª | notifications_page.dart | GET /notifications |
| 9 | Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ | messages_page.dart | WebSocket |
| 10 | Ø·Ù„Ø¨ Ø§Ù„ØºÙŠØ§Ø¨ | request_absence_page.dart | POST /attendance/absence |
| 11 | Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± | attendance_history_page.dart | GET /attendance/history |
| 12 | Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ | parent_profile_page.dart | GET/PUT /profile |
| 13 | Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª | more_page.dart | âŒ |
| 14 | Ø¹Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ | about_app_page.dart | âŒ |
| 15 | ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ | contact_us_page.dart | âŒ |
| 16 | Ø§Ù„Ø®ØµÙˆØµÙŠØ© | privacy_policy_page.dart | âŒ |
| 17 | ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± | change_password_page.dart | PUT /profile/password |
| 18 | Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ | location_picker_screen.dart | Places API |

---

# 7. Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø±

## 7.1 Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø®ÙˆØ§Ø¯Ù…

| Ø§Ù„Ø®Ø¯Ù…Ø© | Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª |
|--------|----------|
| **Laravel Server** | 2 CPU, 4GB RAM, Ubuntu 22.04 |
| **Supabase** | Pro Plan ($25/month) |
| **Redis** | 2GB RAM |
| **Firebase** | Blaze Plan (pay-as-you-go) |

## 7.2 Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª

| Ø§Ù„Ù…Ù†ØµØ© | Ø§Ù„Ù…ØªØ·Ù„Ø¨ |
|--------|---------|
| **iOS** | iOS 12.0+, Apple Developer ($99/year) |
| **Android** | API 21+, Google Play ($25 one-time) |

## 7.3 Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ

| Ø§Ù„Ù…Ø±Ø­Ù„Ø© | Ø§Ù„Ù…Ø¯Ø© |
|---------|-------|
| Ø¥Ø¹Ø¯Ø§Ø¯ Supabase | 1 ÙŠÙˆÙ… |
| Ø¨Ù†Ø§Ø¡ Laravel API | 5-7 Ø£ÙŠØ§Ù… |
| Ø±Ø¨Ø· Flutter Ø¨Ø§Ù„Ù€ API | 3-4 Ø£ÙŠØ§Ù… |
| Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± | 2-3 Ø£ÙŠØ§Ù… |
| Ø§Ù„Ù†Ø´Ø± | 1-2 Ø£ÙŠØ§Ù… |

**Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 12-17 ÙŠÙˆÙ… Ø¹Ù…Ù„**

---

*ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø¨ØªØ§Ø±ÙŠØ®: 2026-01-17*
